{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/04_vite_intro/",
    "result": {"data":{"cur":{"id":"4583a193-1019-535d-b0e8-75359d2dfea5","html":"<p>작년에 회사에서 리뉴얼 프로젝트가 있었다. 기존 서비스에서 UI, 기능을 개선해 유저에게 새롭게 선보이는 것이었다. 프레임워크부터 다 새로 정할 수 있는 상황이었는데 팀장님께서 Vite를 써보자고 하셨다.\n당시에 Vite가 뭐지..? 하면서도 깊이 있게 찾아보지 않고 열심히 React 코드만 쳤던 기억이 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEw0lEQVQ4yz2S60/TdxSH+3fsH9grY+I2dRszm8wEDcNsGSZbjC+2JTMjqPMyuQwRGKU3CoUCbYG2QEEp10Jb6JW2FNqCUO4MrZepiWIiTMhApP09S3+6fZOT8+75Pud8jmRr4yXb6Xq5zs7W36SfIIiNVGqP/MvXOPJ5Np9k5vBhRhYHPjrOwcPHyTqdi1l2hYi+kommcubaFMSNVUggxdvaQeAF+8ITksltERiNTpKRmc3HmTki8IOMLDKOZXHoSCYHjpxAU3iFpQ4lMUMFCx1K4qYqJClhG0HY523fISVs8Sb1QgSqamo4cPRLjn6RzaHPTpH91Rlsahlnc7/n4Kcn+e6bM8RNcmZaK1nsUDJnrkIiCG9EoCBsiTBBEN4BkyjVtXybk0tp3i9UXsjDUFLASk87htJi3nv/MCdPnGKuTclMq5TFdgULbXIkKV4jCP8giIa7CEKKZGpXNJyZvYOqpISin35Efvki0rzzyC7mU3Ehn7Nf52IozGe1S/2/4aIIFCFpwz0EBFLCDknhFQJ7JN+8plujojLvPH0qKdqrl+iXlxNoUhA1KIgYpCx2qMTdpXeZtpSAQFLYZF9YJ5WGCvsiMG2+t7ODRV5GU+FVgnoNI7UKfPWV3DEpGdSqGFTfZMWiYtZUxWKH4j8gYiC7wn1SYji7pMSRt9l5vUFnnQLt9avcqpIyUq8k2FjOcIOCujo9A+pSVi1KZo1ScX8iMB1C+vD2hGeiWZK/RLskKV5uPseoq6ZTdoPbFSVMtWtw193A1lpLc7OJAWUJKxYlcbNMBM6bZWlg6t0hb7LHGs/Wl4nFnDjszVjapZSV/YxRVURj8UV6lAUEDFKG1IW0G0oZ1Vaw2CZjxiglbpTy1F7/dmSBJJuv1piaNuIYVmMblNNrLeNWZxEmUxHW5kpabl6jv7qYqFFNoL2SRw/aWQnqiDbeZM4sZd3dwFK3FMnCgpd4fAivuw77sAy/r45QsAmPW83oiAqvV8MtQzm6wl/priomZFXyIGHm8eN27t5rZd6v5ZFdg6+xgIJzp5C4XQpco3Kczir8vlomJ3REI81EJvUEA1q83mo6zEWYVL8x7lSSSBi5d8/I8qKeu6utJBIdzE3ouPxDDmdPH0MSCNQwEa7H61XhcSuJTOoIj+uZnmphKtpCNKInPK7G5SrH569iekrN/JyWP1f1rK2YWFs28vRJJ+FQDefPnUTS11vCiFNKujsdzQTGmhnztxAMWBnz1+NxtbE0FyESSX+ixevREh63MnPHTHy2ialYHw8SFjY2eug2X0cSiw7R063ENtiJ29WPbdDCeCiIx+1gyCanp7sOhz2M06FjednAmN+Dxx1gzD/I5IQDn9fLVMzK8+cdRMe1SGLhRUJjQcb8blyjA3RaNFi7WxkcuI3Xo8E+1IDT4WQ81Ec0YsA2MIjbFcTv68fruc3IyDDh8VYePmxhbdWCxG0Ps7xwl/k5O73WWvp6/8Bhb2Gg3yyOnL7HIVstfr+O6Wk9gbFGJifNBAL1uFy/Y7NVMzOjIZFo5n6iE4l/NMbSwirLy256rTcY6K9goE+G06EgFKzH76/G6ZARCmmIxbTE4w3Mz2uZmJDT1XUJn6+U2dla1tYMPHrYxb+ycZV+duyJMgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"what is this\"\n        title=\"what is this\"\n        src=\"/static/61d8dff617eb1466c151c94a928f5ac2/37523/09_what-is-this-edit.png\"\n        srcset=\"/static/61d8dff617eb1466c151c94a928f5ac2/e9ff0/09_what-is-this-edit.png 180w,\n/static/61d8dff617eb1466c151c94a928f5ac2/f21e7/09_what-is-this-edit.png 360w,\n/static/61d8dff617eb1466c151c94a928f5ac2/37523/09_what-is-this-edit.png 720w,\n/static/61d8dff617eb1466c151c94a928f5ac2/5a190/09_what-is-this-edit.png 800w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>지금이라도 Vite가 어떤 문제를 해결하기 위해 나왔고, 그 문제를 해결하기 위해 어떻게 했는지 알아보려고 한다.\n(공식 문서 가이드 중 <a href=\"https://vitejs.dev/guide/why.html\">Why Vite</a> 챕터를 참고해 작성되었습니다.)</p>\n<h2 id=\"해결하고자-한-문제점\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0%ED%95%98%EA%B3%A0%EC%9E%90-%ED%95%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"해결하고자 한 문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결하고자 한 문제점</h2>\n<p>ES modules를 브라우저에서 사용하지 못하던 시절에 모듈화된 방식으로 자바스크립트를 작성하기 위한 기본(=native) 메카니즘이 없었다. 그래서 어느 브라우저에서나 돌아가는 모듈화된 앱을 만들기 위해 번들링을 하게 되었다.</p>\n<p>webpack, Rollup, Parcel과 같은 다양한 번들링 툴이 나왔고 프론트엔드 개발자들의 DX를 크게 향상시켜주었다.</p>\n<p>그러나, 우리가 좀 더 발전된 앱을 만들어 갈수록, 다루는 자바스크립트의 양도 기하급수적으로 증가했다. 규모가 큰 프로젝트에서 수천개의 모듈을 갖고 있는 것은 보통이었다.</p>\n<p>결국 위 툴들에 기반한 자바스크립트는 성능 문제에 부딪히기 시작했다. 개발 서버를 돌리거나, 파일을 수정하고 브라우저에 반영되기까지 꽤 긴 시간이 소요되었다.</p>\n<p>느린 속도는 개발자의 생산성에 큰 영향을 끼친다. Vite는 이것을 해결하고자 했다. 이제는 거의 모든 브라우저에서 ES modules를  지원한다는 것과, compile-to-native 언어 Go로 쓰여진 새로운 번들러 esbuild의 출현을 통해서 말이다.</p>\n<blockquote>\n<p>프랑스어로 vite은 quick을 뜻한다.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQoz3VS0W7DIAzM///gqmra+t5lEC0UYxvfZGfLSKpZOiLw+TibTKodKREaKQyG3geYwfOqChHFkgnMCrO/vGPb9zibfCmrgbmHoNkRfi4iIVwroHLM952nwZmcfLu9g4jgMZI9WDhuZxa8XC7IywIWBVEDNT7AeZMv8zyjNd4Fx/D85kBwfX3D/WNGY0Gl9oRwOBb/ip2/HtHyT+HZmSME3aETmRkschA6t96YsZZH4FHpf4c+w1orvtb1qd3RZa2Ez5QDXiyq0fqImOGosf0u/QTb57g/FAtSykh5QSkl3PveO/0GwuR1KSYdf5UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vite translate\"\n        title=\"vite translate\"\n        src=\"/static/588b7cd1966174de3e432f23654be76e/1e043/10_vite-translate.png\"\n        srcset=\"/static/588b7cd1966174de3e432f23654be76e/e9ff0/10_vite-translate.png 180w,\n/static/588b7cd1966174de3e432f23654be76e/f21e7/10_vite-translate.png 360w,\n/static/588b7cd1966174de3e432f23654be76e/1e043/10_vite-translate.png 690w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"어떻게-해결했는가\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EA%B2%B0%ED%96%88%EB%8A%94%EA%B0%80\" aria-label=\"어떻게 해결했는가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떻게 해결했는가</h2>\n<h3 id=\"느린-서버-시작-시간을-esbuild-와-native-esm을-사용해-해결\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%A6%B0-%EC%84%9C%EB%B2%84-%EC%8B%9C%EC%9E%91-%EC%8B%9C%EA%B0%84%EC%9D%84-esbuild-%EC%99%80-native-esm%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4-%ED%95%B4%EA%B2%B0\" aria-label=\"느린 서버 시작 시간을 esbuild 와 native esm을 사용해 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느린 서버 시작 시간을 esbuild 와 native ESM을 사용해 해결</h3>\n<p>개발 서버가 처음 시작될 때, 서브되기 전까지 번들러는 열심히 전체 앱을 빌드한다.</p>\n<p>Vite는 앱의 모듈을 Dependencies와 Source code 두개의 카테고리로 나누어 개발 서버의 시작 시간을 단축시켰다.</p>\n<p>Dependencies는 개발하는 동안 자주 변경되지 않는 자바스크립트이다. 수백개의 모듈을 가진 컴포넌트 라이브러리같은 Dependency는 처리 비용이 많이 든다. 또 다양한 라이브러리를 사용하다보면 각 Dependency 마다 사용하는 모듈 포맷(ES modules나 commonJS)이 다를 수도 있다.</p>\n<p>그래서 Vite는 esbuild를 사용해 Dependencies를 미리 번들한다. esbuild는 위에서 작성한 바와 같이 Go로 작성되었고, 자바스크립트를 기반으로 한 번들러보다 10-100배 이상 빠르다. 이로써 처리 비용이 많이 드는 Dependencies를 미리, 좀 더 빨리 해치울 수 있고, 다양한 Dependencies가 쓰는 모듈 포맷을 맞추기 위해 신경쓸 필요가 없다.</p>\n<p>Source code는 JSX나 CSS와 같이 변환이 필요한, 자주 수정될 수 있는 자바스크립트이다. 그리고 모든 Source code가 한번에 불러와질 필요는 없다.</p>\n<p>Vite는 Source code를 <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules\">native ESM</a>을 사용해 제공한다. 브라우저에게 번들러 작업의 일부를 하게 한 것이다. Vite는 브라우저가 요청할 때만 소스코드를 제공한다. Route를 기반으로 동적 imports가 처리되기 때문에 실제 유저가 보고 있는 화면만 그때 그때 처리된다.</p>\n<h3 id=\"느린-업데이트를-native-esm과-http-헤더를-활용해-해결\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%A6%B0-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%EB%A5%BC-native-esm%EA%B3%BC-http-%ED%97%A4%EB%8D%94%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4-%ED%95%B4%EA%B2%B0\" aria-label=\"느린 업데이트를 native esm과 http 헤더를 활용해 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느린 업데이트를 native ESM과 HTTP 헤더를 활용해 해결</h3>\n<p>업데이트 속도는 앱 크기에 따라 선형적으로 저하된다. 때문에 번들러 기반 빌드 셋업에서 파일이 수정될 때, 전체 번들을 다시 빌드하는 것은 효율적이지 않다.</p>\n<p>어떤 번들러에서는, 개발 서버가 메모리에서 번들링을 실행한다. 그래서 파일에 변경점이 있을 때, 모듈 그래프의 한 부분을 비활성화하면 된다. 하지만 이것 역시 전체 번들을 재구성하고 웹페이지를 다시 불러와야 한다.\n번들을 재구성하는데 비용이 많이 들 수 있으며 페이지를 다시 로드하면 앱의 현재 상태가 사라진다.</p>\n<p>이것이 번들러들이 HMR(Hot Module Replacement)를 지원하는 이유이다. (HMR: 다른 페이지에 영향을 주지 않으면서 모듈 자체의 빠른 교체를 가능하게 하는 것)</p>\n<p>HMR은 DX를 크게 향상시킨다. 그러나 실제로 Vite 팀은 앱 사이즈가 커질수록 HMR의 업데이트 속도 또한 함께 떨어지는 것을 발견했다.</p>\n<p>그래서 Vite 에서는 HMR이 native ESM 기반으로 실행되게 했다. 파일이 수정됐을때, Vite는 수정된 모듈과 가장 가까운 HMR 바운더리의 연결고리만 비활성화시킨다. 이것으로 앱의 크기와 상관없이 HMR 업데이트를 빠르게 만들어준다. (여기서 정확히 어떤 로직으로 동작하는지 좀 더 찾아봐야할 것 같다.)</p>\n<p>또 Vite는 HTTP 헤더를 활용해 전체 페이지 리로드 속도를 향상시켰다. 소스코드 모듈 요청은 <code class=\"language-text\">304:Not Modified</code>를 통해 조건부 처리되며, 디펜던시 모듈 요청은 <code class=\"language-text\">Cache-Control: max-age=31536000, immutable</code> 을 통해 캐시되게 해 한번 캐시되면 서버에 다시 요청하지 않는다.</p>\n<h2 id=\"vite-뭐-되는구나-개발자한테\" style=\"position:relative;\"><a href=\"#vite-%EB%AD%90-%EB%90%98%EB%8A%94%EA%B5%AC%EB%82%98-%EA%B0%9C%EB%B0%9C%EC%9E%90%ED%95%9C%ED%85%8C\" aria-label=\"vite 뭐 되는구나 개발자한테 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vite 뭐 되는구나 개발자한테</h2>\n<p>Vite는 DX 향상을 위한 즉 개발자를 위한 툴이라는 것을 느꼈다.\n실제로 사용해 봤을 때, 로컬에서 매우 빠르게 실행되는 것을 체감했고 수정 사항도 빠릿빠릿하게 반영되었다.</p>\n<p>Production에서는 여전히 번들링 툴을 사용하고 있는데, 그 이유는 ES modules 사용 시에 중첩된 imports로 인한 네트워크 요청이 불필요하게 생길 수 있기 때문이다. Production에서 최적의 성능을 얻기 위해서는 아직까진 tree-shaking, lazy-loading, common chunk splitting을 하는 것이 효과적이라고 한다.</p>\n<p>그렇다면 Production에서 번들링할 때 왜 esbuild를 쓰지 않는 것일까?\n그 이유는 esbuild 자체적으로 아직 완벽하지 않기 때문이다. esbuild는 여전히 개발 중인 피쳐가 있는 상황이다. (code-splitting, CSS handling 등)</p>\n<p>그리하여 현재 Vite팀은 <a href=\"https://rollupjs.org/guide/en/\">Rollup</a> 이라는 툴을 Production 번들러로 사용하고 있다.</p>\n<h2 id=\"ref\" style=\"position:relative;\"><a href=\"#ref\" aria-label=\"ref permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ref</h2>\n<ul>\n<li><a href=\"https://vitejs.dev/guide/why.html\">https://vitejs.dev/guide/why.html</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%ED%95%B4%EA%B2%B0%ED%95%98%EA%B3%A0%EC%9E%90-%ED%95%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90\">해결하고자 한 문제점</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EA%B2%B0%ED%96%88%EB%8A%94%EA%B0%80\">어떻게 해결했는가</a></p>\n<ul>\n<li><a href=\"#%EB%8A%90%EB%A6%B0-%EC%84%9C%EB%B2%84-%EC%8B%9C%EC%9E%91-%EC%8B%9C%EA%B0%84%EC%9D%84-esbuild-%EC%99%80-native-esm%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4-%ED%95%B4%EA%B2%B0\">느린 서버 시작 시간을 esbuild 와 native ESM을 사용해 해결</a></li>\n<li><a href=\"#%EB%8A%90%EB%A6%B0-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%EB%A5%BC-native-esm%EA%B3%BC-http-%ED%97%A4%EB%8D%94%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4-%ED%95%B4%EA%B2%B0\">느린 업데이트를 native ESM과 HTTP 헤더를 활용해 해결</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#vite-%EB%AD%90-%EB%90%98%EB%8A%94%EA%B5%AC%EB%82%98-%EA%B0%9C%EB%B0%9C%EC%9E%90%ED%95%9C%ED%85%8C\">Vite 뭐 되는구나 개발자한테</a></p>\n</li>\n<li>\n<p><a href=\"#ref\">ref</a></p>\n</li>\n</ul>\n</div>","excerpt":"작년에 회사에서 리뉴얼 프로젝트가 있었다. 기존 서비스에서 UI, 기능을 개선해 유저에게 새롭게 선보이는 것이었다. 프레임워크부터 다 새로 정할 수 있는 상황이었는데 팀장님께서 Vite를 써보자고 하셨다.\n당시에 Vite가 뭐지..? 하면서도 깊이 있게 찾아보지 않고 열심히 React 코드만 쳤던 기억이 있다.  지금이라도 Vite가 어떤 문제를 해결하기 위해 나왔고, 그 문제를 해결하기 위해 어떻게 했는지 알아보려고 한다.\n(공식 문서 가이드 중 Why Vite 챕터를 참고해 작성되었습니다.) 해결하고자 한 문제점 ES modules를 브라우저에서 사용하지 못하던 시절에 모듈화된 방식으로 자바스크립트를 작성하기 위한 기본(=native) 메카니즘이 없었다. 그래서 어느 브라우저에서나 돌아가는 모듈화된 앱을 만들기 위해 번들링을 하게 되었다. webpack, Rollup, Parcel과 같은 다양한 번들링 툴이 나왔고 프론트엔드 개발자들의 DX를 크게 향상시켜주었다. 그러나, 우리…","frontmatter":{"date":"April 10, 2022","title":"Vite 너 뭐 돼?","categories":"challenge","author":"유자","emoji":"⚡️"},"fields":{"slug":"/04_vite_intro/"}},"next":{"id":"e3e4bd22-de42-5d07-9c90-91d48ab34b72","html":"<p>웹에서 채팅 기능을 구현할 기회가 있었다. 소켓을 활용해 실시간 채팅을 구현하는 것 외에도 애를 먹었던 작업f이 있었는데, 바로 스크롤이었다.</p>\n<p>이전 채팅 목록을 확인하기 위해 스크롤을 위로 올리면 유저가 보고 있는 스크롤은 그대로 유지한 채, 위에만 내용을 불러와 붙여야 했다.</p>\n<p>이 작업을 React 프로젝트에서 어떻게 접근했는지 적어보려고 한다.</p>\n<h2 id=\"박스-나누기\" style=\"position:relative;\"><a href=\"#%EB%B0%95%EC%8A%A4-%EB%82%98%EB%88%84%EA%B8%B0\" aria-label=\"박스 나누기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>박스 나누기</h2>\n<p>아래 이미지처럼 채팅창이 있다고 가정해보자.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 461px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.88888888888887%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQ4y52U0UsCQRDG/ffrIQO1NDHLTBMf6iV6iKCgQOihkiS9wwdBVPQhJO/U83a+mD03V+3O04GPgb3Z383szk4EcyOiPx9Wq3vZIvqC67oYj8fSK81mM0wmk39l27b8rjOWgI7jyKB+v49er4dut4vBYCDBQggpPbvpdCr3+AL5b6PRCM1mE6ZpwjAMtFot6KaXx/EbgZZlycw6nc6S2u02fn4scKjrEoTgDJ1gIJc2HA5Rr9fXVKvVYNvfKs+5cyQ08AzVIS9KhMyG7aUCXFwRyteEyxLQMBnmyBhfoF6CdlzS7u4Je1EgliTsHwJvH1sCubSnZ0I2T8iXCIUyCyiWCbkiYJg7AG9uCdEEkMoSjjNAMgOkTgmxJFD93LpkD1p5JaTPvKzOC+wJmRzw1dgSKMi70YdHwkGccJQG4ieERNrL+r26Q8lEqk1Ia5n5uxcb+nAduLhtlYVsI/Y+8aHaZjFhsFTeDsDg0RUKuPpSgizUcODx5Tf/VsWDxBeoFtTcCyv98hj4C3xGwcM4aI/QAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chat basic\"\n        title=\"chat basic\"\n        src=\"/static/650e3fcf989fb24400fcf90830bff1a5/f816d/03_chat-basic.png\"\n        srcset=\"/static/650e3fcf989fb24400fcf90830bff1a5/e9ff0/03_chat-basic.png 180w,\n/static/650e3fcf989fb24400fcf90830bff1a5/f21e7/03_chat-basic.png 360w,\n/static/650e3fcf989fb24400fcf90830bff1a5/f816d/03_chat-basic.png 461w\"\n        sizes=\"(max-width: 461px) 100vw, 461px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>채팅창을 감싸는 컨테이너(= chatContainer)를 만들었다. 이 컨테이너는 유저가 채팅을 보는 가시 영역이 된다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 461px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACB0lEQVQ4y5WUa08aQRSG/fdNmpTQtGgTNU35ILHacpMYwdor/YCKpEC9ALsQ7lDbNNiCXM7TzM4uSASKJ3lzdnbeefbM7pxdwQ4RsfKgJ/Q6wu2Nlrru/xVqZ3AZEfIxKBzBeQjMj8rvrNd5xRqM9ODaEBIbkIvCxR5cRLS+hyEbFFuQDQjnESxv69IGju4Bhfo3KCb6/OxWqDUr1FtlfvxqWHMTMc6NDFROFwCVoRC/pdosUsiZFPIGlXJ1vB3lGw2F4UD7q2dKC4BNC9ij1i5SNEuUShMZhkmn07EWKaiKagoLuhCY/9Kl0jQwCiam6aiIYRh0u507WxYaaadCmQWEeloon0y9pqkI74PbI6yug+elEA8K7cxcoFBPQ/lYP11tSx+liQ4/CBuvwLsleHeF432h9RCgym+CwmO38HRV8KwLa5uwtiGseYWvoYUVYgOxgTp/igtbO8L2W8G3C75dwbcD2yHh9EBopZcC6i85sis/eCc8eiK4PeB6LriegeuF8DkgtLMPAOrzJ5wkhdd+IbAH/rDgD0EwKiSjQnP5Cqd7dDr0TQWrJOeew/tABzYaCcMhYw2cTkkt7BQbmJgGzpJTve6U/wAdwzKhel9B5wJrKbiK6n/cTRv+XM+Wmut3ofCecWfNBHaakPFD/giuYpA7nKOY9mQD8Ls6Azj/ay4Xd9f+AxLQqFjpBStmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chat container\"\n        title=\"chat container\"\n        src=\"/static/b922e17ff241c0190fd55c338cd6bf96/f816d/04_chat-container.png\"\n        srcset=\"/static/b922e17ff241c0190fd55c338cd6bf96/e9ff0/04_chat-container.png 180w,\n/static/b922e17ff241c0190fd55c338cd6bf96/f21e7/04_chat-container.png 360w,\n/static/b922e17ff241c0190fd55c338cd6bf96/f816d/04_chat-container.png 461w\"\n        sizes=\"(max-width: 461px) 100vw, 461px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그리고 채팅 리스트를 감싸는 컨테이너(= chatListContainer)를 만들었다. 채팅 리스트 컨테이너 최상단에는 채팅 목록을 추가로 불러올 트리거 역할을 하는 요소(= loadMoreTrigger)를 두었다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 461px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZElEQVQ4y5WUS2/aUBBG84MrZROFPtQ0RE2bf9BVu+mqm26qiJRUIZXSSpUCFYjwCm/CwxiKTTAYsOdUtiFAeCS50ufxtcdH353rO1sAIsI0rlKjY5Ctd4gVVMrNLunqP/INjaKiM7Zs5hlb3sS9utG+k7hyXiWrHS6SNULxG8J5lXCuSSBS4leqxtheAZx/cH848IoJtRE0LLgZgTKG0tCL1pyZO6A9mdW0Af5AivenGd4FPR0GMxycpNkPOEq59/6TtBtfHycptg3mGQvAfM/mW3lAvGkQrhtEGj3+KgZR1SSmDoi50XTnybZJoGKS6dqrgJ5tZ2k5fUgjn6ZwnaaQSVIvF1g36kMoGN639vKShVIfktoYTW1SayjUGwpqq8XANF2NxhbOpo4sLz/XE/KGbHYYUw2yySuuEkkSiYSreDxONBrlttuZbqF7LfadMgkzxj2g4zClW5i3Opqmo+te1LSuG5XmiFodqg2hpQipjlDor1yyNykaQra3tmR8+gzPdoTdPdjxCcdhoWqtBXoOr3tefSzbi0pTyOWFQlH4/UcInsGPc+E8JFxWhJK5waEHnE8QPnwUtnfh1YGwdwj+I8F/BAdvhe9RoTp+FHDmWtOFy4jjTFxnp2dCMAShsyc5nJxl20v+8lXY9gkv9sG3Jzx/A76XwnFkYw2XHU7Pd/fWq6XaArUlKCrobSGjPbDLy0uGxZ4hy/+hsfY/XOVw1oncVjZ5Zk1KUTCck8LjgNZCb1yUNcl3YBuBRcPTY0el/wCw3IefrZnT7Bo575yci/a029wDTms1sj3oUzS0FzfvPxUtRSD6Fj3kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"load more trigger with container\"\n        title=\"load more trigger with container\"\n        src=\"/static/c8ecd5e812069c107cb73b14e2facf15/f816d/07_load-more-trigger-with-container.png\"\n        srcset=\"/static/c8ecd5e812069c107cb73b14e2facf15/e9ff0/07_load-more-trigger-with-container.png 180w,\n/static/c8ecd5e812069c107cb73b14e2facf15/f21e7/07_load-more-trigger-with-container.png 360w,\n/static/c8ecd5e812069c107cb73b14e2facf15/f816d/07_load-more-trigger-with-container.png 461w\"\n        sizes=\"(max-width: 461px) 100vw, 461px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>아래 그림은 유저가 스크롤을 올려 chatListContainer 끝의 loadMoreTrigger가 가시 영역에 포함되는 상황이다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQ4y12TWW/aQBSF89P71D60VRcpVYoitYqyNVJFN7XKTtIkzdYSgzGhoSwJOBBsjMFmM9yvsk2AdqQ70oxmPp1z58yMiDA9Ov0B6ZLFn0oT7cai0/OC/f/Ptb0+mds6BcMmV2vgySDYn/Enu93nvFgnfm2x/dskmqqxlTf4nKmi290xpKZ7JBQXTW0TO3X4dmyzpzTZPGli3E0BC86A06pDouaQ77j8yLd5suzy8otLwfXGwJ3NLit7NT4dGWwrJksbdR7M1XkYMTk76d8DBb0F3SbgwN46LL+Fp48gMg9GOzAMQ0FVJpZzedjagdkIvP8A6cvwXADUkpA4aKAd6xytd4i9g91FYWtFSByNejcUlF9gtFyMms3u/oC9Qzg6HXJ4LKgpmShMqpDJ6uSLGSrVIm6rHjIQlHMJBPqViMPV9Q257BWNxh0Q9rfXFZJJmSj0gZVql07HxfNa6LcuG9sQOxNSSqhu6A0CoG5amLUajUaFsm6TzYF2KaiqTB7FpzdbobPzOHzdgFevhYVoCLwt66Q1LQB2/XZ6oN/C/gE8fiEsroKmMWU5CVYjlBz7LjybFebmGQFHloHEhdAf+V/7KDx/LUQWYDUqaOl/FN4DwXGEpBY2WckKajy07EMuDqF0JbR1IXUsLEWEtTcQXRBSF1NAVYWWM4rHeEiwUi/ugVAywaxCxxS6Foh/xxWaJpSscWwgHod8CZptMG3BsMGy4doSfp5MLOt9sEdL33oP8GNvi1DuTSmsXoNyTpDHVCIsLRHGpJydaK73oOBCuQ2lqSq6YIcfhb9cQ8rU/JuF7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"scroll\"\n        title=\"scroll\"\n        src=\"/static/ce34f65d25474d6d23f4f7bcd47ac8f4/37523/08_scroll.png\"\n        srcset=\"/static/ce34f65d25474d6d23f4f7bcd47ac8f4/e9ff0/08_scroll.png 180w,\n/static/ce34f65d25474d6d23f4f7bcd47ac8f4/f21e7/08_scroll.png 360w,\n/static/ce34f65d25474d6d23f4f7bcd47ac8f4/37523/08_scroll.png 720w,\n/static/ce34f65d25474d6d23f4f7bcd47ac8f4/2b2c6/08_scroll.png 869w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"infinite-스크롤-만들기---intersectionobserver\" style=\"position:relative;\"><a href=\"#infinite-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EB%A7%8C%EB%93%A4%EA%B8%B0---intersectionobserver\" aria-label=\"infinite 스크롤 만들기   intersectionobserver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Infinite 스크롤 만들기 - IntersectionObserver</h2>\n<p>Web API에서 제공하는 <a href=\"https://developer.mozilla.org/ko/docs/Web/API/Intersection_Observer_API\">IntersectionObserver</a>를 사용해 Infinite 스크롤을 구현했다.</p>\n<p>위 예제 이미지의 loadMoreTrigger가 IntersectionObserver의 observe 하는 대상이 된다. 유저가 스크롤을 올려 loadMoreTrigger가 가시영역에 들어오게 되면(= isIntersecting) 다음 대화목록을 불러오는 api 요청을 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> loadMoreTrigger <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLDivElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> isloadMore <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> loadMoreObserver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> isIntersecting <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">onFetchPreviousPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        isloadMore<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> trigger <span class=\"token operator\">=</span> loadMoreTrigger<span class=\"token punctuation\">.</span>current<span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n  loadMoreObserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>trigger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    loadMoreObserver<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>trigger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>onFetchPreviousPage<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"스크롤-위치-유지하기---resizeobserver\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%81%AC%EB%A1%A4-%EC%9C%84%EC%B9%98-%EC%9C%A0%EC%A7%80%ED%95%98%EA%B8%B0---resizeobserver\" aria-label=\"스크롤 위치 유지하기   resizeobserver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스크롤 위치 유지하기 - ResizeObserver</h2>\n<p>이전 대화 목록을 불러오니 스크롤이 불러온 데이터를 따라 위로 올라갔다. 채팅 목록이 추가되어도 스크롤이 따라 올라가지 않게끔  하기 위해 사용한 것이\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver\">ResizeObserver</a> 이다.</p>\n<ul>\n<li>위 예제 그림에서 chatListContainer를 observe 대상으로 했다. 이전 대화 목록을 불러와 chatListContainer에 resize 이벤트가 발생하면 콜백이 실행된다.</li>\n<li>콜백 인자로 받는 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserverEntry\">ResizeObserverEntry</a>를 사용해 변경된 childNodes의 갯수(= nodesRecord)와 높이(= scrollRecord)를 저장해주었다.</li>\n<li>채팅방에 처음 진입했을 경우는 nodeRecord가 초기값(= 0)인 것을 활용해 구분했다.</li>\n<li>채팅에 데이터가 추가된 경우는 nodeRrecord에 저장된 값과 현재 변경된 childNodes의 갯수가 다를 때만으로 한정지었다. (채팅 데이터를 불러오는 과정에서 resize 이벤트가 한번만 발생하지 않기 때문이다.)\n<ul>\n<li>이때 isLoadMore가 false인 경우는 추가된 데이터가 있지만 trigger로 불러온 데이터가 아니므로 새로운 메시지가 온 것에 대한 구분을 하는데 사용했다.</li>\n<li>그 외 경우엔 요소의 변경된 높이(= contentRect.height)에서 앞서 저장해두었던 scrollRecord를 뺀 값만큼 스크롤을 내려 위치를 유지시킬 수 있었다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> containerRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLDivElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> chatListContainerRef <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>HTMLDivElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> scrollRecord <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>number<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> nodesRecord <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>number<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/** loadMoreTrigger 상태 관리용 */</span>\n<span class=\"token keyword\">const</span> isloadMore <span class=\"token operator\">=</span> useRef<span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> containerRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> chatListContainer <span class=\"token operator\">=</span> chatListContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> callback<span class=\"token operator\">:</span> <span class=\"token function-variable function\">ResizeObserverCallback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">entries</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/** 처음 진입 시 스크롤 맨 아래로 */</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>nodesRecord<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        top<span class=\"token operator\">:</span> Number<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_SAFE_INTEGER</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      isloadMore<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">/** 채팅 데이터가 추가될 경우 */</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nodesRecord<span class=\"token punctuation\">.</span>current <span class=\"token operator\">!==</span> entry<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>childNodes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">/** 추가된 데이터가 있는데 isLoadMore가 false인 경우는 새로운 채팅이므로 맨 아래로 내림 */</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isloadMore<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          container<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            top<span class=\"token operator\">:</span> Number<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_SAFE_INTEGER</span><span class=\"token punctuation\">,</span>\n            behavior<span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/** 이 외에는 resized된 높이에서 이전에 저장해놓은 높이 만큼을 내려 스크롤의 위치를 유지시킴 */</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          isloadMore<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n          container<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            top<span class=\"token operator\">:</span> entry<span class=\"token punctuation\">.</span>contentRect<span class=\"token punctuation\">.</span>height <span class=\"token operator\">-</span> scrollRecord<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/** 추가된 채팅 노드 정보 업데이트 */</span>\n    nodesRecord<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>childNodes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    scrollRecord<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>contentRect<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResizeObserver</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>chatListContainer<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> box<span class=\"token operator\">:</span> <span class=\"token string\">'border-box'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    observer<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%B0%95%EC%8A%A4-%EB%82%98%EB%88%84%EA%B8%B0\">박스 나누기</a></li>\n<li><a href=\"#infinite-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EB%A7%8C%EB%93%A4%EA%B8%B0---intersectionobserver\">Infinite 스크롤 만들기 - IntersectionObserver</a></li>\n<li><a href=\"#%EC%8A%A4%ED%81%AC%EB%A1%A4-%EC%9C%84%EC%B9%98-%EC%9C%A0%EC%A7%80%ED%95%98%EA%B8%B0---resizeobserver\">스크롤 위치 유지하기 - ResizeObserver</a></li>\n</ul>\n</div>","frontmatter":{"date":"March 27, 2022","title":"웹에서 채팅 스크롤 구현해보기","categories":"challenge","author":"유자","emoji":"🔬"},"fields":{"slug":"/03_web_chatting_scroll/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://www.yuzaalist.dev","comments":{"utterances":{"repo":"Youn-Ji/yuzaalist.dev"}}}}},"pageContext":{"slug":"/04_vite_intro/","nextSlug":"/03_web_chatting_scroll/","prevSlug":""}},
    "staticQueryHashes": ["1073350324","1956554647","712016698"]}